# 调试

## 调试9法

### 1、理解系统

- 阅读手册

	- 除草机温度过高，未通读手册

- 逐字逐句阅读 整个手册

	- 因为有的关键信息正好可能被你遗漏了

- 查阅手册

	- 有些东西不要凭自己的记忆，要翻阅资料进行确认

- 知道什么是正常的

	- 知道什么是正常的 会帮助你注意什么不是正常的   还有基础知识很关键，手册是假定你知道某些基础知识的

- 知道工作流程

	- 知道系统的整个架构及各个模块或环节的工作流程

- 了解你的工具，包括工具的局限性

	- 调试工具
	- 开发工具
	- 编译器和链接器等

### 2、制造失败

- 原因

	- 可以观察失败时的具体情况
	- 可以专心查找原因，准确地知道问题在什么条件下发生

		- 应从各个因素考虑

	- 可以判断bug是否已经被修复

- 注意点

	- 从头开始

		- 因为有的bug 仅仅在某个复杂的状态下才发生，因此必须仔细注意机器在执行各个步骤时的状态

	- 不要模拟失败（也就是模拟失败机理本身，如书中写的保存文档丢失图片的例子），而是引发失败（也就是模拟发生失败的条件，如放大效果法---书中提到的窗户喷水 或者自动化(过程/测试)法---书中提到的自动移动仪器的例子）
	- 在引发失败时不要画蛇添足
	- 不要 轻易说出“那不可能发生”

		- 汽车启动 和冰淇淋的例子

	- 永远不要丢掉调试（测试）工具

- 如何处理间歇性bug

	- 出现间歇性bug的原因

		- 存在你没注意到或者无法控制的因素，如初始条件、输入数据等（没完全弄清楚失败是如何发生的，不知道完整的、准确的条件）
		- 测试者是否清醒

	- 找到那些你没有注意到或者不可控的可能的影响因子，并大量测试这些影响因子的不同状态或条件
	- （1、查找不受你控制的条件；2、记录每一件事情，并找到间歇性bug的特征）

- 如果做了所有尝试，间歇性bug还存在

	- 仔细观察失败
	- 不要盲目的相信统计数据
	- 是bug已经修复了 还是运气好导致它暂时没有发生

### 3、不要想（猜测），而要看

- 观察失败

	- 一定要亲眼看到bug发生的实际情况，而不是靠猜测，观察往往比猜测更快的找到答案；猜测虽然看起来是个捷径，但它不会带你找到问题的根源

		- 楼栋管理员把插座拔掉的例子
		- 换新水泵的例子

- 查看细节

	- 一直观察，直到把问题的原因锁定在几种可能性之内

- 问题忽隐忽现

	- 在调试间歇性bug时，观察底层的失败细节有一个好处就是 看到底层的失败细节后，当你认为已修复bug时，很容易证明确实已修复，你不必依靠统计数据就可以看到错误不再发生。

- 对系统进行插装

	- 设计插装工具（测试点）

		- 调试模式编译的情况下

			- 源代码调试器来观察程序的运行

		- 发布模式编译的情况下

			- 在性能监视器中输入各种有意义的变量，以便在运行时观察它们

	- 过后构建插装
	- 不要害怕深入研究
	- 添加外部插装
	- 日常生活中的插装

		- 体温计
		- X光透视
		- 水温计、压力计

- 海森堡 测不准原理

	- 测量一个粒子的位置和测量它向哪个位置运动，这两者当中有一个测量得越精确，另一个就越测不准
	- 不要让仪器影响了系统

- 猜测只是为了确定搜索的重点目标

	- 不要想，而要看并不是真的意味着不能做任何猜想
	- 不要过分相信你的猜测，它们往往偏离了方向
	- 例外的情况：如果某些问题比其他问题更容易出现（出现的概率大）或者比其他问题更易于修复，则应该首先检查这些问题；（易发生且易修复，则可以直接尝试修复它，而不需要真正看到失败的细节）

		- 灯不亮的例子

			- 灯或者开关坏了

		- 电热水器的例子

			- 内部保险丝或者跳闸了

### 4、分而治之

- 缩小搜索范围

	- 确定范围
	- 确定你位于bug的哪一侧

		- 如果你所在的位置有排放物。则排放管就在上游，如果没有，则在下游

- 插入易于识别的模式

	- 从干净、清澈的水开始，以便当排放物进入河流中时很容易看到它

- 从有问题的分支开始查找问题

	- 如果从正确的部分开始验证，那么需要验证的地方太多了

- 修复已知的bug

	- bug相互保护，相互隐藏

- 首先消除噪音干扰

### 5、一次只改一个地方

- 使用步枪而不是用散弹枪（控制变量法）
- 用双手抓住黄铜杆（核潜艇）

	- 如果不清楚具体发生了什么问题就试图修复bug，会很危险！

- 一次只改变一个测试

	- 如果所做的更改没有起到预期作用 应该把它改回去（  汽车不启动的例子--N档 P档 钥匙没有转到位 ）

- 与正常系统进行对比
- 确定自从上次正常工作以来你改变了什么

	- 不一定是最近一次的修改导致的，有可能很早就影响了
	- 唱片机 唱头的例子

### 6、跟踪记录(保持审计跟踪)

- 记下你的每次操作、顺序和结果

	- 要描述的非常清楚，以实物过敏为例，什么时候吃了什么有什么反应等

- 魔鬼隐藏在细节中

	- 没穿鞋子 感到电击 的例子
	- 视频压缩芯片崩溃是由于格子寸衫造成的例子

- 把事件关联到一起

	- 将某些症状与其他症状或调试信息关联起来是非常有用的

- 用于设计的 审计跟踪（指源代码版本管理工具） 在测试中也非常有用
- 好记性不如烂笔头

### 7、检查是否犯了哪些低级错误 (检查插头)

- 怀疑自己的假设

	- 通常，问题发生在较低的层次上，也就是你可能犯了低级错误，如汽车启动不了 可能是没油了，而不是化油器的问题

- 从头开始检查

	- 如 使用除草机之前，你是否按了3次primer

- 对工具进行测试

	- 编译器是否是二进制的例子
	- 燃料油表是否被粘住了的例子

### 8、 求助( 获取全新观点)

- 寻求帮助

	- 获得全新观点

		- 有时候向别人解释问题也会使你有全新的认识，因为对事件进行组织的过程迫使你跳出你原来的思维模式（（这里有点类似 小黄鸭调试法））

	- 询问专家
	- 听取别人的经验

		- 刹车灯保险丝断掉 跟车顶灯线露出的例子
		- 维修机器，敲击方法的例子

- 到哪里寻求帮助

	- 同事
	- 供应商
	- 网络
	- 书店

- 放下面子

	- 专家也可能出错
	- 以除掉bug为自豪，而不要非得以自己除掉bug才为自豪

- 报名症状而不是理论

	- 不要把理论告诉帮助你的人而是现象，否则他可能被你拉到你的思维定势中，导致有些关键的细节被忽略了

- 把症状的每个细节也描述清楚并别遗漏了
- 让帮助你的人复现bug
- 即使不十分肯定也可以提出来

### 9、如果你不修复bug，它将依然存在

- 检查问题确实已经被修复

	- 汽车低档位熄火的例子---原因是滤油器而不是线路问题

- 检查确实是修复措施解决了问题

	- 检查方法是 你修复了问题后，取消这个修复，看bug是否再现，如果再现了，再把修复加上，再次验证问题是否已被修复

- bug从来不会自己消失
- 从根本上解决问题

	- 收音机变压器的例子

- 对过程进行修复

	- 不要只是擦掉地上的油，而是要纠正设计机器的方式（四个螺钉而不是两个）

*XMind: ZEN - Trial Version*